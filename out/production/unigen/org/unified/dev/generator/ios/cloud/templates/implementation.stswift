~+ header~

public class Default~= module.name ~CloudApi: ~= module.name ~CloudApi, CloudConnectorDependent {

	// MARK: - Component


	public var dependency: DependencyResolver!


	// MARK: - Methods


~ for (Cloud_method method : api.methods) { ~
	public ~+ method_header~ {
		let methodUrl = cloudConnector.makeUrl(~= swift.quoted(method.url) ~)
~	if (method.params != null && method.params.is_struct_type()) { ~
		let params = ~= swift.struct_implementation_creation(method.params) ~
~		for (Cloud_struct_field param : method.params.struct_type().fields) { ~
		params.~= param.identifier ~ = ~= param.identifier ~
~		} ~
~	} ~
~	if (method.params != null) { ~
		let paramsJson = ~= method.params.get_to_json_conversion_method_name() ~(params)
~	} ~
~	if (method.params != null && method.result != null) { ~
		let resultJson = try cloudConnector.invokeService(methodUrl, ~= method.protocol ~, ~= swift.quoted(method.method) ~, paramsJson)
		let result = ~= method.result.get_from_json_conversion_method_name()~(resultJson)
		return result
~	} ~
~	else if (method.params != null) { ~
		try cloudConnector.invokeService(methodUrl, ~= method.protocol ~, ~= swift.quoted(method.method) ~, paramsJson);
~	} ~
~	else if (method.result != null) { ~
		let resultJson = try cloudConnector.invokeService(methodUrl, ~= method.protocol ~, ~= swift.quoted(method.method) ~, nil)
		let result = ~= method.result.get_from_json_conversion_method_name()~(resultJson)
		return result
~	} ~
~	else { ~
		try cloudConnector.invokeService(methodUrl, ~= method.protocol ~, ~= swift.quoted(method.method) ~, nil);
~	} ~
	}
~ } ~



	// MARK: - Types

~ for (Cloud_struct_type struct_type : api.struct_types) { ~
~	if (!struct_type.used_in_method_params) { ~
	public func create~= struct_type.implementation_name ~() -> ~= struct_type.interface_name ~ {
		return ~= struct_type.implementation_name ~()
	}
~	} ~
~ } ~


~ for (Cloud_struct_type struct_type : api.struct_types) { ~
~	if (!struct_type.used_in_method_params) { ~
	public class ~= struct_type.implementation_name ~: ~= struct_type.interface_name ~ {
~ 	for(Cloud_struct_field field: struct_type.fields) { ~
		public var ~= field.identifier ~~= swift.implementation_field_type_declaration(field.declaration) ~
~ 	} ~

		public static var converter = Converter() as CloudApiStructConverter<~= struct_type.interface_name ~>
		private class Converter: CloudApiStructConverter<~= struct_type.interface_name ~> {
			init() {
				super.init( { ~= struct_type.implementation_name ~() as ~= struct_type.interface_name ~ }, [
~	int index = 0; ~
~ 	for(Cloud_struct_field field: struct_type.fields) { ~
					CloudApiFieldConverter<~= struct_type.interface_name ~>(~= swift.quoted(field.name) ~, ~= swift.quoted(field.declaration.type.get_record_schema_name()) ~,
						{ object, source in object.~= field.identifier ~ = ~= field.declaration.get_from_json_conversion_method_name() ~(source) },
						{ object in ~= field.declaration.get_to_json_conversion_method_name() ~(object.~= field.identifier ~) })~= index < struct_type.fields.length - 1 ? ", " : "" ~
~ 		++index; ~
~ 	} ~
				]);
			}
		}
	}





~	} ~
~ } ~
}